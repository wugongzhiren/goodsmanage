<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title></title>
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/css/ui.jqgrid.css"/>
    <link rel="stylesheet" type="text/css" href="/css/jquery-ui.min.css"/>
    <link rel="stylesheet" type="text/css" href="/css/my.css"/>
    <script src="/js/jquery-3.1.1.min.js"></script>
    <!-- 包括所有已编译的插件 -->
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/grid.locale-cn.js"></script>
    <script src="/js/grid.jqueryui.js"></script>
    <script src="/js/jquery.jqGrid.min.js"></script>
    <style type="text/css">
        .ui-jqgrid .ui-jqgrid-titlebar{
            background: #FF6700;
            color:white;
            height: 50px;
            line-height: 30px;
            font-size: large;
        }
    </style>
</head>
<body>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">×
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    会员开户
                </h4>
            </div>
            <!--//模态框内容-->
            <div class="modal-body">
                二维码：
                <input class="form-control" id="identyCode" onkeypress="scanEnter()" type="text" placeholder="扫描微信二维码    " />
                识别码(选填)：
                <input class="form-control" id="phoneNum" type="text" placeholder="请输入手机号码或者QQ或者微信号" />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">关闭
                </button>
                <button type="button" class="btn btn-primary" onclick="vipReg()">
                    确认开户
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div style="width: 90%; background: white;margin: 40px;">
    <div class="instoreTitle" style="margin-left:60px;margin-top: 20px;font-size: 36px;font-weight: 400;line-height: 68px;color: #b0b0b0;">
        <h1>会员积分信息查询与新会员注册</h1></div>
</div>
<hr/>
<input id="vipID" class="form-control" style="width: 300px;margin-left: 150px" type="text" placeholder="输入会员识别码"/>
<br/>
<div style="margin-left: 150px">
<button class="btn instoreBtn" onclick="reloadList()">查询</button>
<button class="btn instoreBtn" data-toggle="modal" data-target="#myModal">会员开户</button>
</div>
<hr/>
<center>
    <table id="list"></table>
</center>

    <script>

        function scanEnter() {
            if(event.keyCode==13){
                $("#phoneNum").focus();
            }
        }
        $(function () {
            $(".ui-jqgrid-titlebar-close").remove();
            $('#myModal').modal('hide');

            $('#myModal').on('hide.bs.modal',
                function() {
                //对话框关闭时清空
                    $("#identyID").val("");
                    $("#phoneNum").val("");
                })

            $('#myModal').on('shown.bs.modal',
                function() {
                    //对话框关闭时清空
                    $("#identyCode").focus();
                    $("#phoneNum").val("");
                })
        })


        jQuery("#list").jqGrid({
            url: "/getVIPInfo",
            datatype: "local",
            mtype: 'GET',
            colNames: [ '会员识别码',  '积分', '注册时间'],
            colModel: [
                {name: 'vipID', index: 'vipID', width: 100, align: "center"},
                {name: 'score', index: 'score', width: 150, align: "center"},
                {name: 'creatDate', index: 'creatDate', width: 150, align: "center"}
            ],
            rownumbers:true,
            multiselect: true,
            multiboxonly:true,
            loadComplete: function () {

            },
            beforeSelectRow:function beforeSelectRow()
            {

            },
            viewrecords: true,
            loadonce:false,
            sortable: false,
//width: 'auto',
            width: '1000',
            height: '540',
            caption: "会员列表"
        })


        //会员开户
        function vipReg() {
            var vipID=$("#phoneNum").val();
            var identyCode=$("#identyCode").val();
            /*<![CDATA[*/
            if(vipID==""&&identyCode==""){
                /*]]>*/
                return;
            }

            //后台通信，保存信息到数据库
            $.ajax({
                url: '/creatVIP',
                type: "get",
                data: {
                    vipID: vipID,
                    identityCode:identyCode
                },
                error: function (error) {
                    alert("抱歉，系统异常，请刷新后重新操作")
                },
                success: function (data) {
                    if(data=="100") {
                        alert("操作成功");
                        $('#myModal').modal('hide')
                        return;
                    }
                    if(data=="102") {
                        alert("已经注册过，请直接使用");
                        return;
                    }
                    if(data=="101"){
                        alert("操作失败")
                        return;
                    }
                }
            })
        }

        //会员列表重新加载
        function reloadList() {
            var vipid=$("#vipID").val();
            $("#list").jqGrid('setGridParam',{
                datatype:'json',
                mtype: 'GET',
                postData:{'identityCode':vipid} //发送数据
                /*page:1*/
            }).trigger("reloadGrid"); //重新载入
        }
    </script>
</body>

</html>